<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2299.77">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="zh-TW"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;Buen Camino - 法國之路助手&lt;/title&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Tailwind CSS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Vue.js 3 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://unpkg.com/vue@3/dist/vue.global.js"&gt;&lt;/script&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Leaflet CSS &amp; JS (地圖) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"&gt;&lt;/script&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- FontAwesome (圖標) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Google Fonts --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>body {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: 'Inter', sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">            </span>-webkit-tap-highlight-color: transparent;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #f3f4f6;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* 隱藏 Scrollbar 但保持滑動功能 */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.hide-scrollbar::-webkit-scrollbar {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: none;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.hide-scrollbar {</p>
<p class="p1"><span class="Apple-converted-space">            </span>-ms-overflow-style: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>scrollbar-width: none;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* 地圖容器 */</p>
<p class="p1"><span class="Apple-converted-space">        </span>#map {</p>
<p class="p1"><span class="Apple-converted-space">            </span>height: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>z-index: 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* 模擬 App 轉場效果 */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.fade-enter-active, .fade-leave-active {</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: opacity 0.2s ease;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.fade-enter-from, .fade-leave-to {</p>
<p class="p1"><span class="Apple-converted-space">            </span>opacity: 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* Camino Yellow */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.text-camino { color: #f59e0b; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.bg-camino { background-color: #f59e0b; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.border-camino { border-color: #f59e0b; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* 自定義 Popup 樣式 */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.leaflet-popup-content-wrapper {</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 12px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>overflow: hidden;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.leaflet-popup-content {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body class="bg-gray-100 text-gray-800 h-screen overflow-hidden"&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="app" class="h-full flex flex-col relative max-w-md mx-auto bg-white shadow-2xl overflow-hidden"&gt;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Top Bar (Header) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;header class="bg-blue-600 text-white p-4 shadow-md z-20 flex justify-between items-center shrink-0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h1 class="text-lg font-bold flex items-center gap-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;i class="fa-solid fa-shell text-yellow-300"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>Buen Camino</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p class="text-xs text-blue-100"&gt;{{ currentStageName || '準備出發' }}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button @click="showSyncStatus" class="text-white hover:text-yellow-300 transition"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;i class="fa-solid fa-cloud-arrow-down"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Main Content Area --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;main class="flex-grow overflow-y-auto hide-scrollbar relative bg-gray-50"&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- VIEW: DASHBOARD --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div v-if="currentView === 'dashboard'" class="p-4 space-y-4 pb-20"&gt;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Weather Forecast &amp; Clothing Advice Widget (Collapsible) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="bg-gradient-to-br from-blue-600 to-blue-400 rounded-2xl text-white shadow-lg relative overflow-hidden transition-all duration-300"</p>
<p class="p1"><span class="Apple-converted-space">                     </span>:class="isWeatherExpanded ? 'p-5' : 'p-4'"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Background Decor --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="absolute right-0 top-0 opacity-10 transform translate-x-8 -translate-y-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;i class="fa-solid fa-sun text-9xl"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="relative z-10"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;!-- Header / Main Display --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="flex justify-between items-start" @click="isWeatherExpanded = !isWeatherExpanded"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="cursor-pointer"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;p class="text-xs opacity-90 flex items-center gap-1 mb-1"&gt;&lt;i class="fa-solid fa-location-dot"&gt;&lt;/i&gt; Pamplona (今日)&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div class="flex items-center gap-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;h2 class="text-5xl font-bold tracking-tighter transition-all duration-300" :class="isWeatherExpanded ? 'text-5xl' : 'text-3xl'"&gt;22°&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div class="text-sm opacity-90"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;p class="font-semibold text-lg leading-tight"&gt;多雲時晴&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;p class="text-xs" v-if="isWeatherExpanded"&gt;H:23° L:14°&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                            </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;!-- Toggle Button &amp; Mini Stats --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="flex flex-col items-end"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;button class="text-white/80 hover:text-white p-1 mb-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;i class="fa-solid transition-transform duration-300" :class="isWeatherExpanded ? 'fa-chevron-up' : 'fa-chevron-down'"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/button&gt;</p>
<p class="p2"><span class="Apple-converted-space">                                </span></p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div v-if="isWeatherExpanded" class="text-right text-sm font-medium flex flex-col items-end gap-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div class="bg-white/20 backdrop-blur-sm px-2 py-1 rounded text-xs flex items-center gap-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;i class="fa-solid fa-droplet"&gt;&lt;/i&gt; 10%</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div class="bg-white/20 backdrop-blur-sm px-2 py-1 rounded text-xs flex items-center gap-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;i class="fa-solid fa-wind"&gt;&lt;/i&gt; 12km/h</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;!-- Expanded Content --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div v-if="isWeatherExpanded" class="mt-4 transition-all duration-300 ease-in-out"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;!-- Clothing Advice --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="bg-white/20 backdrop-blur-md rounded-xl p-3 mb-5 flex items-start gap-3 border border-white/10"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div class="bg-yellow-400/20 w-8 h-8 rounded-full flex items-center justify-center shrink-0 text-yellow-300 border border-yellow-200/30"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;i class="fa-solid fa-shirt text-sm"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;p class="text-[10px] font-bold text-blue-50 opacity-80 uppercase tracking-wider mb-0.5"&gt;今日穿搭建議&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;p class="text-sm font-medium leading-snug"&gt;{{ clothingAdvice }}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;!-- Hourly Forecast (Horizontal Scroll) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="border-t border-white/10 pt-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div class="flex gap-5 overflow-x-auto pb-2 hide-scrollbar"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div v-for="(hour, idx) in hourlyForecast" :key="idx" class="flex flex-col items-center gap-1 min-w-[2.5rem]"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;span class="text-[10px] opacity-80"&gt;{{ hour.time }}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;i class="fa-solid text-lg my-1" :class="[hour.icon, idx === 2 ? 'text-yellow-300' : 'text-white']"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;span class="text-sm font-bold"&gt;{{ hour.temp }}°&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Progress Card --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="bg-white rounded-2xl p-5 shadow-sm border border-gray-100"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h3 class="font-bold text-gray-700 mb-3"&gt;朝聖進度&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="relative w-16 h-16 flex items-center justify-center rounded-full border-4 border-yellow-400 text-yellow-600 font-bold text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>{{ progressPercentage }}%</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="flex-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="flex justify-between text-sm mb-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="text-gray-500"&gt;已完成&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="font-bold"&gt;{{ completedKm.toFixed(1) }} km&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="flex justify-between text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="text-gray-500"&gt;剩餘&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="font-bold text-blue-600"&gt;{{ remainingKm }} km&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="text-xs text-gray-400 mt-2"&gt;法國之路總長約 779 km&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Next Stop Recommendation (Dynamic) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div v-if="nextRecommendedAlbergue" class="bg-white rounded-2xl p-5 shadow-sm border border-gray-100 cursor-pointer hover:bg-gray-50 transition" @click="showPoiOnMap(nextRecommendedAlbergue)"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex justify-between items-center mb-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;h3 class="font-bold text-gray-700"&gt;下一站推薦&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span class="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>{{ nextRecommendedAlbergue.category === 'Xunta' ? '公立 (Xunta)' : nextRecommendedAlbergue.category }}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex gap-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="w-20 h-20 rounded-lg bg-blue-100 flex items-center justify-center shrink-0 text-blue-500"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;i class="fa-solid fa-bed text-3xl"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="flex-1 min-w-0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;h4 class="font-bold truncate text-gray-800"&gt;{{ nextRecommendedAlbergue.name }}&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;p class="text-xs text-gray-500 line-clamp-2 mt-1"&gt;{{ nextRecommendedAlbergue.description }}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="mt-2 flex items-center gap-3 text-xs"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="text-yellow-500 font-medium"&gt;&lt;i class="fa-solid fa-star"&gt;&lt;/i&gt; 推薦&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="text-gray-300"&gt;|&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="text-blue-600 font-medium"&gt;{{ nextRecommendedAlbergue.price }}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="text-gray-300"&gt;|&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="text-gray-500"&gt;{{ nextRecommendedAlbergue.beds }} 床&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div v-else class="bg-white rounded-2xl p-5 shadow-sm border border-gray-100 flex items-center justify-center text-gray-400 text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>恭喜！您已完成所有行程。</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- VIEW: MAP --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- 使用 v-show 保持地圖實例不被銷毀 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div v-show="currentView === 'map'" class="h-full relative w-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="map" class="w-full h-full"&gt;&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Map Controls Overlay --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="absolute top-4 right-4 z-[400] flex flex-col gap-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="locateUser" class="bg-white w-10 h-10 rounded-full shadow-md flex items-center justify-center text-blue-600 active:bg-gray-100"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;i class="fa-solid fa-location-crosshairs"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="downloadOfflineMap" class="bg-white w-10 h-10 rounded-full shadow-md flex items-center justify-center text-gray-600 active:bg-gray-100"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;i class="fa-solid fa-download"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Filter Chips --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="absolute top-4 left-4 z-[400] flex gap-2 overflow-x-auto max-w-[70%] hide-scrollbar"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="toggleMapFilter('albergue')" :class="filters.albergue ? 'bg-blue-600 text-white' : 'bg-white text-gray-600'" class="px-3 py-1.5 rounded-full text-xs font-medium shadow-md whitespace-nowrap transition"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;i class="fa-solid fa-bed mr-1"&gt;&lt;/i&gt; 住宿</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="toggleMapFilter('sight')" :class="filters.sight ? 'bg-purple-600 text-white' : 'bg-white text-gray-600'" class="px-3 py-1.5 rounded-full text-xs font-medium shadow-md whitespace-nowrap transition"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;i class="fa-solid fa-camera mr-1"&gt;&lt;/i&gt; 景點</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="toggleMapFilter('food')" :class="filters.food ? 'bg-green-600 text-white' : 'bg-white text-gray-600'" class="px-3 py-1.5 rounded-full text-xs font-medium shadow-md whitespace-nowrap transition"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;i class="fa-solid fa-utensils mr-1"&gt;&lt;/i&gt; 餐飲</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="toggleMapFilter('water')" :class="filters.water ? 'bg-blue-400 text-white' : 'bg-white text-gray-600'" class="px-3 py-1.5 rounded-full text-xs font-medium shadow-md whitespace-nowrap transition"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;i class="fa-solid fa-faucet mr-1"&gt;&lt;/i&gt; 水源</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- POI Detail Card (Popup replacement) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;transition name="fade"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div v-if="selectedPOI" class="absolute bottom-4 left-4 right-4 bg-white rounded-xl shadow-2xl p-4 z-[401] border-l-4 border-yellow-400 max-h-[60vh] overflow-y-auto"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="flex justify-between items-start"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;h3 class="font-bold text-lg"&gt;{{ selectedPOI.name }}&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;!-- 類別標籤 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div class="flex items-center gap-2 mt-1 mb-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;span v-if="selectedPOI.category" class="text-xs px-2 py-0.5 rounded font-medium"</p>
<p class="p1"><span class="Apple-converted-space">                                          </span>:class="{</p>
<p class="p1"><span class="Apple-converted-space">                                              </span>'bg-green-100 text-green-700': selectedPOI.category === '公立' || selectedPOI.category === 'Xunta',</p>
<p class="p1"><span class="Apple-converted-space">                                              </span>'bg-purple-100 text-purple-700': selectedPOI.category === '私立',</p>
<p class="p1"><span class="Apple-converted-space">                                              </span>'bg-yellow-100 text-yellow-700': selectedPOI.category === '教會'</p>
<p class="p1"><span class="Apple-converted-space">                                          </span>}"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>{{ selectedPOI.category === 'Xunta' ? '公立 (Xunta)' : selectedPOI.category }}</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div class="text-xs text-gray-500 capitalize"&gt;{{ getPoiTypeLabel(selectedPOI.type) }}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;button @click="selectedPOI = null" class="text-gray-400 p-1"&gt;&lt;i class="fa-solid fa-xmark"&gt;&lt;/i&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                        </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div v-if="selectedPOI.type === 'albergue'" class="mt-2 text-sm space-y-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;!-- Basic Info --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="flex items-center gap-4 text-gray-700"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div class="flex items-center gap-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;i class="fa-solid fa-euro-sign w-4 text-center text-blue-500"&gt;&lt;/i&gt;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;span class="font-semibold"&gt;{{ selectedPOI.price }}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div class="flex items-center gap-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;i class="fa-solid fa-bed w-4 text-center text-blue-500"&gt;&lt;/i&gt;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;span&gt;{{ selectedPOI.beds }} 床位&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                            </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;!-- Phone --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="flex items-center gap-2 text-gray-600"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;i class="fa-solid fa-phone w-4 text-center text-gray-400"&gt;&lt;/i&gt; {{ selectedPOI.phone }}</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;!-- Facilities --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="flex flex-wrap gap-1 mt-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span v-for="fac in selectedPOI.facilities" :key="fac" class="text-xs bg-gray-100 px-2 py-1 rounded text-gray-600 flex items-center gap-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;i v-if="fac === 'kitchen'" class="fa-solid fa-fire-burner"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;i v-if="fac === 'laundry'" class="fa-solid fa-jug-detergent"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;i v-if="fac === 'wifi'" class="fa-solid fa-wifi"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;i v-if="fac === 'pool'" class="fa-solid fa-person-swimming"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;i v-if="fac === 'bar'" class="fa-solid fa-beer-mug-empty"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;i v-if="fac === 'dinner'" class="fa-solid fa-utensils"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;i v-if="fac === 'garden'" class="fa-solid fa-tree"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;i v-if="fac === 'hot_water'" class="fa-solid fa-shower"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;i v-if="fac === 'single_rooms'" class="fa-solid fa-door-closed"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>{{ getFacilityName(fac) }}</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;!-- Description --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;p class="text-gray-600 text-xs leading-relaxed border-t border-gray-100 pt-2 mt-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>{{ selectedPOI.description }}</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/p&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;!-- Landmarks --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div v-if="selectedPOI.landmarks" class="bg-yellow-50 p-2 rounded-lg border border-yellow-100 mt-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div class="flex items-start gap-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;i class="fa-solid fa-map-pin text-yellow-600 mt-0.5 text-xs"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;span class="text-xs font-bold text-yellow-800 block"&gt;附近景點：&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;span class="text-xs text-yellow-900"&gt;{{ selectedPOI.landmarks }}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div v-else class="mt-2 text-sm text-gray-600"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>{{ selectedPOI.description }}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button class="w-full mt-3 bg-blue-600 text-white py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition"&gt;導航至此&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/transition&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- VIEW: STAGES --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div v-if="currentView === 'stages'" class="p-4 space-y-3 pb-20"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="flex justify-between items-center mb-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h2 class="font-bold text-xl"&gt;20 天戰略規劃&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded"&gt;步行總計 {{ totalKm.toFixed(1) }} km&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div v-for="(stage, index) in stages" :key="index"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                     </span>class="bg-white rounded-xl p-4 shadow-sm border transition-all duration-200"</p>
<p class="p1"><span class="Apple-converted-space">                     </span>:class="[</p>
<p class="p1"><span class="Apple-converted-space">                        </span>stage.completed ? 'border-green-200 bg-green-50 opacity-75' : 'border-gray-100',</p>
<p class="p1"><span class="Apple-converted-space">                        </span>stage.type === 'bus' ? 'border-l-4 border-l-blue-400' : '',</p>
<p class="p1"><span class="Apple-converted-space">                        </span>stage.type === 'rest' ? 'border-l-4 border-l-purple-400' : ''</p>
<p class="p1"><span class="Apple-converted-space">                     </span>]"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center gap-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div @click="toggleStage(index)" class="cursor-pointer"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors"</p>
<p class="p1"><span class="Apple-converted-space">                                 </span>:class="stage.completed ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300 text-transparent'"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;i class="fa-solid fa-check text-xs"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="flex-1" @click="expandStage(index)"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="flex justify-between items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div class="flex items-center gap-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;h3 class="font-bold text-gray-800" :class="{'line-through text-gray-500': stage.completed}"&gt;Day {{ index + 1 }}&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;span v-if="stage.type === 'bus'" class="text-[10px] bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded"&gt;&lt;i class="fa-solid fa-bus"&gt;&lt;/i&gt; 巴士移動&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;span v-if="stage.type === 'rest'" class="text-[10px] bg-purple-100 text-purple-700 px-1.5 py-0.5 rounded"&gt;&lt;i class="fa-solid fa-mug-hot"&gt;&lt;/i&gt; 休息日&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="text-sm font-medium text-blue-600"&gt;{{ stage.km }} km&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="text-sm text-gray-500 flex justify-between mt-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;span v-if="stage.from"&gt;{{ stage.from }}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;i v-if="stage.to" class="fa-solid fa-arrow-right text-xs mx-1"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>{{ stage.to || '原地休息' }}</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Expanded Details --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div v-if="expandedStageIndex === index" class="mt-3 pt-3 border-t border-gray-100 text-sm text-gray-600"&gt;</p>
<p class="p2"><span class="Apple-converted-space">                        </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;!-- 戰略分析區塊 (最優先顯示) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div v-if="stage.description" class="bg-yellow-50 p-3 rounded-lg border border-yellow-100 mb-3 text-gray-700"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="font-bold text-yellow-800 text-xs mb-1"&gt;&lt;i class="fa-solid fa-lightbulb"&gt;&lt;/i&gt; 戰略分析：&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>{{ stage.description }}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;!-- 具體的起點與終點庇護所資訊 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div v-if="stage.startAlbergue || stage.endAlbergue" class="mb-3 space-y-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                             </span>&lt;div v-if="stage.startAlbergue" class="flex gap-2 text-xs"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="text-gray-500 shrink-0 w-8"&gt;起點：&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="text-gray-800 font-medium"&gt;{{ stage.startAlbergue }}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div v-if="stage.endAlbergue" class="flex gap-2 text-xs"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="text-gray-500 shrink-0 w-8"&gt;終點：&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="text-gray-800 font-medium"&gt;{{ stage.endAlbergue }}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div v-if="stage.type !== 'rest' &amp;&amp; stage.type !== 'bus'" class="flex justify-between mb-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;p&gt;&lt;span class="font-semibold text-gray-800"&gt;難度：&lt;/span&gt;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span :class="{</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>'text-red-500': stage.difficulty === 'Hard',</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>'text-yellow-600': stage.difficulty === 'Medium',</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>'text-green-600': stage.difficulty === 'Easy'</p>
<p class="p1"><span class="Apple-converted-space">                                </span>}"&gt;{{ stage.difficulty }}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;button class="text-blue-600 font-medium text-xs flex items-center gap-1" @click="flyToStage(index)"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;i class="fa-solid fa-map"&gt;&lt;/i&gt; 地圖查看</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;!-- Accommodation &amp; POI Section within Stage --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div v-if="stage.to &amp;&amp; stage.type !== 'bus' &amp;&amp; stage.type !== 'rest'" class="border-t border-gray-200 pt-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;h4 class="font-bold text-gray-700 text-sm mb-2 flex items-center gap-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;i class="fa-solid fa-bed text-blue-500"&gt;&lt;/i&gt; 推薦住宿 ({{ stage.to }})</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/h4&gt;</p>
<p class="p2"><span class="Apple-converted-space">                            </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div v-if="getStagePois(stage.to).length &gt; 0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div v-for="poi in getStagePois(stage.to)" :key="poi.id" class="bg-gray-50 rounded-lg p-3 mb-2 border border-gray-200 shadow-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div class="flex justify-between items-start mb-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;h5 class="font-bold text-gray-800 text-sm"&gt;{{ poi.name }}&lt;/h5&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;span class="text-[10px] px-1.5 py-0.5 rounded font-medium"</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>:class="{</p>
<p class="p1"><span class="Apple-converted-space">                                                </span>'bg-green-100 text-green-700': poi.category === '公立' || poi.category === 'Xunta',</p>
<p class="p1"><span class="Apple-converted-space">                                                </span>'bg-purple-100 text-purple-700': poi.category === '私立',</p>
<p class="p1"><span class="Apple-converted-space">                                                </span>'bg-yellow-100 text-yellow-700': poi.category === '教會'</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>}"&gt;{{ poi.category === 'Xunta' ? '公立 (Xunta)' : poi.category }}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                                    </span></p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div class="flex items-center gap-3 text-xs text-gray-600 mb-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;span class="flex items-center gap-1"&gt;&lt;i class="fa-solid fa-euro-sign text-blue-400"&gt;&lt;/i&gt; {{ poi.price }}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;span class="flex items-center gap-1"&gt;&lt;i class="fa-solid fa-bed text-blue-400"&gt;&lt;/i&gt; {{ poi.beds }} 床&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div class="flex flex-wrap gap-1 my-1.5"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;span v-for="fac in poi.facilities" :key="fac" class="text-[10px] bg-white border border-gray-100 px-1.5 py-0.5 rounded text-gray-500"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>{{ getFacilityName(fac) }}</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                                    </span></p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;button @click="showPoiOnMap(poi)" class="w-full mt-2 bg-white border border-blue-200 text-blue-600 text-xs py-1.5 rounded hover:bg-blue-50 transition"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>查看詳細 &amp; 定位</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- VIEW: GUIDE --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div v-if="currentView === 'guide'" class="p-0 h-full flex flex-col"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Tabs --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="flex border-b border-gray-200 bg-white"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="guideTab = 'packing'" :class="guideTab === 'packing' ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-500'" class="flex-1 py-3 text-sm font-medium border-b-2 transition"&gt;裝備清單&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="guideTab = 'emergency'" :class="guideTab === 'emergency' ? 'border-red-600 text-red-600' : 'border-transparent text-gray-500'" class="flex-1 py-3 text-sm font-medium border-b-2 transition"&gt;緊急資訊&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="p-4 overflow-y-auto pb-20"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Packing List --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div v-if="guideTab === 'packing'"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;!-- Weight Dashboard --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 mb-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="flex items-center justify-between"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;h3 class="text-sm font-bold text-gray-700"&gt;🎒 背包總重&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;p class="text-xs text-gray-400"&gt;建議在 10kg 以內&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div class="text-right"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;span class="text-2xl font-bold" :class="totalWeight &gt; 10 ? 'text-red-500' : 'text-blue-600'"&gt;{{ totalWeight }}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;span class="text-sm text-gray-500 ml-1"&gt;kg&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div v-for="(category, catName) in packingList" :key="catName" class="mb-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;h3 class="font-bold text-gray-800 mb-2 flex items-center gap-2 capitalize"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;i class="fa-solid fa-caret-right text-yellow-500"&gt;&lt;/i&gt; {{ catName }}</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="space-y-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;!-- List Items Wrapper --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;template v-for="(item, idx) in category" :key="idx"&gt;</p>
<p class="p2"><span class="Apple-converted-space">                                    </span></p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;!-- Editing Mode (Inline Input) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div v-if="editingState.category === catName &amp;&amp; editingState.index === idx"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                         </span>class="flex items-center gap-2 bg-blue-50 p-2 rounded-lg border border-blue-200 shadow-inner h-[58px]"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;input type="text" v-model="editForm.name"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                               </span>class="flex-1 bg-white border border-blue-200 rounded px-2 py-1 text-sm focus:outline-none focus:border-blue-400"</p>
<p class="p1"><span class="Apple-converted-space">                                               </span>@keyup.enter="saveEdit(catName, idx)" ref="editInput"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;input type="number" v-model="editForm.weight"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                               </span>class="w-16 bg-white border border-blue-200 rounded px-1 py-1 text-sm focus:outline-none focus:border-blue-400 text-center"</p>
<p class="p1"><span class="Apple-converted-space">                                               </span>@keyup.enter="saveEdit(catName, idx)"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;button @click="saveEdit(catName, idx)" class="text-green-600 hover:text-green-700 p-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;i class="fa-solid fa-check"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;!-- Swipeable Item Container --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div v-else class="relative overflow-hidden rounded-lg h-[58px] select-none"&gt;</p>
<p class="p2"><span class="Apple-converted-space">                                        </span></p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;!-- Background Actions (Reveal on swipe) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div class="absolute inset-y-0 right-0 flex w-[120px]"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;button @click="startEditing(catName, idx)" class="w-1/2 bg-gray-200 text-gray-600 flex items-center justify-center hover:bg-gray-300 transition active:bg-gray-400"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                </span>&lt;i class="fa-solid fa-pen"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;button @click="deleteItem(catName, idx)" class="w-1/2 bg-red-500 text-white flex items-center justify-center hover:bg-red-600 transition active:bg-red-700"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                </span>&lt;i class="fa-solid fa-trash-can"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;!-- Foreground Content (Draggable) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div class="absolute inset-0 bg-white border border-gray-100 flex items-center px-3 gap-3 transition-transform duration-200 ease-out"</p>
<p class="p1"><span class="Apple-converted-space">                                             </span>:style="getSwipeStyle(catName, idx)"</p>
<p class="p1"><span class="Apple-converted-space">                                             </span>@touchstart="handleTouchStart($event, catName, idx)"</p>
<p class="p1"><span class="Apple-converted-space">                                             </span>@touchmove="handleTouchMove($event)"</p>
<p class="p1"><span class="Apple-converted-space">                                             </span>@touchend="handleTouchEnd($event)"</p>
<p class="p1"><span class="Apple-converted-space">                                             </span>@mousedown="handleTouchStart($event, catName, idx)"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                             </span>@mousemove="handleTouchMove($event)"</p>
<p class="p1"><span class="Apple-converted-space">                                             </span>@mouseup="handleTouchEnd($event)"</p>
<p class="p1"><span class="Apple-converted-space">                                             </span>@mouseleave="handleTouchEnd($event)"&gt;</p>
<p class="p2"><span class="Apple-converted-space">                                            </span></p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;!-- Checkbox Area --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;div @click="!isSwiping &amp;&amp; toggleItem(catName, idx)" class="cursor-pointer shrink-0 p-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                </span>&lt;div class="w-5 h-5 rounded border flex items-center justify-center transition-colors"</p>
<p class="p1"><span class="Apple-converted-space">                                                     </span>:class="item.checked ? 'bg-blue-500 border-blue-500 text-white' : 'border-gray-300 text-transparent'"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                    </span>&lt;i class="fa-solid fa-check text-xs"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;!-- Content Area --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;div class="flex-1 flex justify-between items-center cursor-pointer" @click="!isSwiping &amp;&amp; toggleItem(catName, idx)"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                </span>&lt;span :class="{'text-gray-400 line-through': item.checked}"&gt;{{ item.name }}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                </span>&lt;span v-if="item.weight" class="text-xs text-gray-400 bg-gray-50 px-1.5 py-0.5 rounded ml-2 whitespace-nowrap"&gt;{{ item.weight }}g&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                                            </span></p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;!-- Visual hint for swipe (optional) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;div class="w-1 h-8 bg-gray-100 rounded-full mx-1 opacity-50"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/template&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;!-- Add Item Row --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div class="flex items-center gap-2 mt-2 px-1 pt-1 h-[40px]"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div class="w-5 h-5 flex items-center justify-center text-gray-300"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;i class="fa-solid fa-plus text-xs"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;input type="text" v-model="newItemInput[catName].name"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                           </span>placeholder="新增裝備..."<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                           </span>class="flex-1 bg-transparent border-b border-gray-200 px-2 py-1.5 text-sm focus:outline-none focus:border-blue-400 placeholder-gray-400 transition-colors"</p>
<p class="p1"><span class="Apple-converted-space">                                           </span>@keyup.enter="addItem(catName)"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;input type="number" v-model="newItemInput[catName].weight"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                           </span>placeholder="克"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                           </span>class="w-14 bg-transparent border-b border-gray-200 px-1 py-1.5 text-sm focus:outline-none focus:border-blue-400 text-center placeholder-gray-300 transition-colors"</p>
<p class="p1"><span class="Apple-converted-space">                                           </span>@keyup.enter="addItem(catName)"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;button @click="addItem(catName)"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                            </span>class="text-blue-500 hover:text-blue-700 w-8 h-8 flex items-center justify-center transition disabled:opacity-30 disabled:cursor-not-allowed"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                            </span>:disabled="!newItemInput[catName].name"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;i class="fa-solid fa-check"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Emergency --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div v-if="guideTab === 'emergency'" class="space-y-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="bg-red-50 border border-red-200 p-4 rounded-xl"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;h3 class="font-bold text-red-700 text-lg mb-2"&gt;&lt;i class="fa-solid fa-triangle-exclamation"&gt;&lt;/i&gt; 歐盟緊急電話&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="text-4xl font-black text-red-600 mb-1"&gt;112&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;p class="text-sm text-red-800"&gt;適用於西班牙全境，可通英語。&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                        </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;h3 class="font-bold mb-2"&gt;主要醫療中心&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="space-y-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div class="border-b pb-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div class="font-medium"&gt;Hospital de Navarra (Pamplona)&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div class="text-sm text-gray-500"&gt;+34 848 42 22 22&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div class="font-medium"&gt;Hospital Clínico (Santiago)&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div class="text-sm text-gray-500"&gt;+34 981 95 00 00&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;h3 class="font-bold mb-2"&gt;實用短語 (西文)&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;ul class="text-sm space-y-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;li&gt;&lt;span class="font-semibold"&gt;我需要幫助:&lt;/span&gt; Necesito ayuda&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;li&gt;&lt;span class="font-semibold"&gt;我受傷了:&lt;/span&gt; Estoy herido&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;li&gt;&lt;span class="font-semibold"&gt;水泡:&lt;/span&gt; Ampollas&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;li&gt;&lt;span class="font-semibold"&gt;藥局:&lt;/span&gt; Farmacia&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/ul&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/main&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Bottom Navigation --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;nav class="bg-white border-t border-gray-200 flex justify-around items-center h-16 shrink-0 z-30 pb-safe"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button @click="setView('dashboard')" :class="currentView === 'dashboard' ? 'text-blue-600' : 'text-gray-400'" class="flex flex-col items-center justify-center w-full h-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;i class="fa-solid fa-house text-xl mb-1"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;span class="text-[10px] font-medium"&gt;首頁&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button @click="setView('map')" :class="currentView === 'map' ? 'text-blue-600' : 'text-gray-400'" class="flex flex-col items-center justify-center w-full h-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;i class="fa-solid fa-map-location-dot text-xl mb-1"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;span class="text-[10px] font-medium"&gt;地圖&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button class="relative -top-5 bg-yellow-400 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center border-4 border-gray-100 transform active:scale-95 transition" @click="quickLog"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;i class="fa-solid fa-person-hiking text-2xl"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button @click="setView('stages')" :class="currentView === 'stages' ? 'text-blue-600' : 'text-gray-400'" class="flex flex-col items-center justify-center w-full h-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;i class="fa-solid fa-list-check text-xl mb-1"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;span class="text-[10px] font-medium"&gt;路段&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button @click="setView('guide')" :class="currentView === 'guide' ? 'text-blue-600' : 'text-gray-400'" class="flex flex-col items-center justify-center w-full h-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;i class="fa-solid fa-book-open text-xl mb-1"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;span class="text-[10px] font-medium"&gt;指南&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/nav&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Toast Notification --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;transition name="fade"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div v-if="toastMsg" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg z-50 text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>{{ toastMsg }}</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/transition&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>// 加入 'watch' 到 Vue 的解構中</p>
<p class="p1"><span class="Apple-converted-space">        </span>const { createApp, ref, computed, onMounted, nextTick, watch } = Vue;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>createApp({</p>
<p class="p1"><span class="Apple-converted-space">            </span>setup() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const currentView = ref('dashboard');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const guideTab = ref('packing');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const toastMsg = ref('');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const expandedStageIndex = ref(null);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const isWeatherExpanded = ref(true);</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 編輯相關狀態</p>
<p class="p1"><span class="Apple-converted-space">                </span>const editingState = ref({ category: null, index: null });</p>
<p class="p1"><span class="Apple-converted-space">                </span>const editForm = ref({ name: '', weight: 0 });</p>
<p class="p1"><span class="Apple-converted-space">                </span>const editInput = ref(null);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Swipe Logic State</p>
<p class="p1"><span class="Apple-converted-space">                </span>const swipeState = ref({</p>
<p class="p1"><span class="Apple-converted-space">                    </span>activeId: null, // format: "category-index"</p>
<p class="p1"><span class="Apple-converted-space">                    </span>startX: 0,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>startY: 0,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentOffset: 0,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>baseOffset: 0,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>isDragging: false</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>const isSwiping = ref(false);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const interactingId = ref(null);<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 地圖相關</p>
<p class="p1"><span class="Apple-converted-space">                </span>let map = null;</p>
<p class="p1"><span class="Apple-converted-space">                </span>let userMarker = null;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const selectedPOI = ref(null);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const filters = ref({ albergue: true, sight: true, food: true, water: false });</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 起點座標: Saint-Jean-Pied-de-Port</p>
<p class="p1"><span class="Apple-converted-space">                </span>const startPoint = { lat: 43.1636, lng: -1.2358 };</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 模擬每小時天氣預報數據</p>
<p class="p1"><span class="Apple-converted-space">                </span>const hourlyForecast = ref([</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ time: '07:00', temp: 14, icon: 'fa-cloud-sun' },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ time: '08:00', temp: 15, icon: 'fa-sun' },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ time: '09:00', temp: 17, icon: 'fa-sun' },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ time: '10:00', temp: 19, icon: 'fa-sun' },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ time: '11:00', temp: 21, icon: 'fa-cloud-sun' },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ time: '12:00', temp: 22, icon: 'fa-cloud' },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ time: '13:00', temp: 23, icon: 'fa-cloud-rain' },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ time: '14:00', temp: 22, icon: 'fa-cloud-rain' },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ time: '15:00', temp: 21, icon: 'fa-cloud' },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ time: '16:00', temp: 20, icon: 'fa-cloud-sun' },</p>
<p class="p1"><span class="Apple-converted-space">                </span>]);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 根據當前氣溫（模擬）提供穿衣建議</p>
<p class="p1"><span class="Apple-converted-space">                </span>const clothingAdvice = computed(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const temp = 22; // 模擬當前氣溫</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (temp &lt; 10) return "寒冷：建議穿著保暖內層、中層衣物及防風外套。";</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (temp &lt; 18) return "涼爽：建議洋蔥式穿法，薄長袖搭配輕量外套。";</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (temp &lt; 25) return "舒適：適合短袖或薄長袖，早晚溫差大請備薄外套。";</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return "炎熱：請著透氣快乾短袖，注意防曬與補充水分。";</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 20 天詳細規劃路段資料 (Part 1 + Part 2 Bus/Rest + Part 3 Final)</p>
<p class="p1"><span class="Apple-converted-space">                </span>const stages = ref([</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Part 1: Classic Beginning (Day 1-11)</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Saint-Jean-Pied-de-Port', to: 'Roncesvalles', km: 24.7, difficulty: 'Hard', terrain: 'Mountain', lat: 43.0094, lng: -1.3194, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "(您在SJPP的住處)",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue de Peregrinos de Roncesvalles",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "精華保留。體驗最經典的庇里牛斯山挑戰。這是朝聖之路最艱難但也最壯麗的一天。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Roncesvalles', to: 'Zubiri', km: 21.4, difficulty: 'Medium', terrain: 'Forest Path', lat: 42.9309, lng: -1.5034, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue de Peregrinos de Roncesvalles",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue Municipal de Zubiri",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "讓雙腿在第一天翻山越嶺後得到恢復，穿梭在幽靜的森林小徑中。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Zubiri', to: 'Pamplona', km: 20.8, difficulty: 'Easy', terrain: 'Road/Path', lat: 42.8125, lng: -1.6458, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue Municipal de Zubiri",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue de Peregrinos Jesús y María",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "輕鬆走進第一個大城 Pamplona，記得去參觀大教堂並享用 Tapas！" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Pamplona', to: 'Puente la Reina', km: 24.3, difficulty: 'Medium', terrain: 'Alto del Perdón', lat: 42.6719, lng: -1.8153, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue de Peregrinos Jesús y María",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue de Peregrinos de los Padres Reparadores",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "精華保留。攀登著名的「寬恕之嶺」(Alto del Perdón)，與朝聖者鐵雕合影。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Puente la Reina', to: 'Estella', km: 21.9, difficulty: 'Medium', terrain: 'Rolling Hills', lat: 42.6713, lng: -2.0313, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue de Peregrinos de los Padres Reparadores",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue Municipal de Peregrinos de Estella",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "享受中世紀村莊風光，Estella 被稱為「北方的托雷多」，歷史氛圍濃厚。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Estella', to: 'Los Arcos', km: 21.6, difficulty: 'Medium', terrain: 'Rolling', lat: 42.5694, lng: -2.1906, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue Municipal de Peregrinos de Estella",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue de Peregrinos Isaac Santiago",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "拜訪知名的 Irache 紅酒噴泉 (Fuente del Vino)，免費品嚐朝聖者紅酒！" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Los Arcos', to: 'Logroño', km: 27.9, difficulty: 'Hard', terrain: 'Rolling', lat: 42.4664, lng: -2.4456, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue de Peregrinos Isaac Santiago",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue Municipal de Peregrinos de Logroño",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "舒適地走進 La Rioja 葡萄酒產區的首都 Logroño，晚上必去 Laurel 街吃 Pintxos。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Logroño', to: 'Nájera', km: 29.3, difficulty: 'Hard', terrain: 'Vineyards', lat: 42.4156, lng: -2.7344, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue Municipal de Peregrinos de Logroño",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue Municipal de Nájera",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "這是少數接近 30km 的一天，但地勢平坦，沿途經過美麗的葡萄園。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Nájera', to: 'Santo Domingo de la Calzada', km: 21.1, difficulty: 'Easy', terrain: 'Rolling', lat: 42.4394, lng: -2.9536, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue Municipal de Nájera",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue de Peregrinos de la Cofradía del Santo",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "輕鬆的一天，終點是著名的「雞舍奇蹟」教堂所在地。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Santo Domingo de la Calzada', to: 'Belorado', km: 22.7, difficulty: 'Easy', terrain: 'Flat', lat: 42.4194, lng: -3.1911, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue de Peregrinos de la Cofradía del Santo",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue de Peregrinos A Santiago",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "舒適地推進，Belorado 擁有不少舒適的私立庇護所。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Belorado', to: 'Burgos', km: 27.5, difficulty: 'Medium', terrain: 'Flat/Urban', lat: 42.3408, lng: -3.7028, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue de Peregrinos A Santiago",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue Municipal de Peregrinos de Burgos",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "穿越山丘與工業區，抵達擁有壯觀大教堂的 Burgos，這裡是第一階段的終點。" },</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Part 2: Strategic Jump (Day 12-13)</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Burgos', to: 'Sarria', km: 0, difficulty: 'None', type: 'bus', terrain: 'Bus Transfer', lat: 42.7778, lng: -7.4125, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>virtualKm: 399.7, // 關鍵：這是被跳過的距離</p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue Municipal de Burgos (步行至巴士站)",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue Internacional Monasterio de la Magdalena",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "🚌 巴士跳躍日：這就是節省時間的秘密！從 Burgos 悠閒探索後，搭乘 ALSA 巴士跳過 300 公里，直接抵達「最後100公里」的起點 Sarria。省下 10-12 天步行時間。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Sarria', to: 'Sarria', km: 0, difficulty: 'None', type: 'rest', terrain: 'Rest Day', lat: 42.7778, lng: -7.4125, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue Internacional Monasterio de la Magdalena",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue Internacional Monasterio de la Magdalena",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "💤 恢復日：在 Sarria 徹底休息。洗滌衣物、採購補給，讓身體從長途車程中恢復，精神飽滿地準備最後衝刺。" },</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Part 3: Final Chapter (Day 14-20)</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Sarria', to: 'Portomarín', km: 22.5, difficulty: 'Easy', terrain: 'Rolling (Galicia)', lat: 42.8067, lng: -7.6156, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue Internacional Monasterio de la Magdalena",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue de Peregrinos de la Xunta de Portomarín",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "精華保留。開始享受「最後100公里」的熱鬧與風景，沿途會有許多提供印章的小店。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Portomarín', to: 'Palas de Rei', km: 25.1, difficulty: 'Medium', terrain: 'Hills', lat: 42.8739, lng: -7.8692, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue de Peregrinos de la Xunta de Portomarín",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue de Peregrinos de la Xunta de Palas de Rei",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "典型的加利西亞丘陵地形，與來自世界各地的朝聖者同行，感受熱鬧氛圍。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Palas de Rei', to: 'Arzúa', km: 29.0, difficulty: 'Hard', terrain: 'Rolling/Forest', lat: 42.9269, lng: -8.1644, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue de Peregrinos de la Xunta de Palas de Rei",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue de Peregrinos de la Xunta de Arzúa",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "途經 Melide，一定要停下來吃頓著名的加利西亞章魚大餐 (Pulpo)！" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Arzúa', to: 'O Pedrouzo', km: 19.5, difficulty: 'Easy', terrain: 'Forest/Eucalyptus', lat: 42.9108, lng: -8.3617, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue de Peregrinos de la Xunta de Arzúa",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Albergue de Peregrinos de la Xunta de Arca do Pino",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "距離終點最近的一站，穿梭在充滿香氣的尤加利樹林中，心情開始激動。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'O Pedrouzo', to: 'Santiago de Compostela', km: 20.0, difficulty: 'Easy', terrain: 'Arrival', lat: 42.8805, lng: -8.5439, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Albergue de Peregrinos de la Xunta de Arca do Pino",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Seminario Menor de la Asunción",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "榮耀日！悠閒地走完最後一程，目標在中午前抵達大教堂廣場，參加朝聖者彌撒。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Santiago', to: 'Santiago', km: 0, difficulty: 'None', type: 'rest', terrain: 'Celebration', lat: 42.8805, lng: -8.5439, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Santiago de Compostela",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Santiago de Compostela",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "🎉 慶祝與探索日：領取堆肥證書、參觀大教堂、逛逛古城，享受屬於您的榮耀時刻。這是您應得的獎勵！" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ from: 'Santiago', to: 'Santiago', km: 0, difficulty: 'None', type: 'rest', terrain: 'Buffer Day', lat: 42.8805, lng: -8.5439, completed: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                      </span>startAlbergue: "Santiago de Compostela",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>endAlbergue: "Santiago de Compostela",</p>
<p class="p1"><span class="Apple-converted-space">                      </span>description: "備用緩衝日：極高的容錯率，可應對任何突發狀況。" }</p>
<p class="p1"><span class="Apple-converted-space">                </span>]);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 模擬數據：POI</p>
<p class="p1"><span class="Apple-converted-space">                </span>const pois = [</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Part 1 Specific Albergues</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 1, lat: 43.0094, lng: -1.3194, name: "Albergue de Peregrinos de Roncesvalles", type: "albergue", category: "教會", location: "Roncesvalles", price: "€14", beds: 183, phone: "+34 948 760 000", facilities: ["kitchen", "laundry", "wifi", "dinner"], landmarks: "聖瑪莉亞聯合教堂", description: "歷史悠久且規模宏大的朝聖者庇護所。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 102, lat: 42.9309, lng: -1.5034, name: "Albergue Municipal de Zubiri", type: "albergue", category: "公立", location: "Zubiri", price: "€10", beds: 46, phone: "無", facilities: ["hot_water", "kitchen"], landmarks: "狂犬病之橋", description: "舊小學改建，基本設施。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 103, lat: 42.8185, lng: -1.6443, name: "Albergue de Peregrinos Jesús y María", type: "albergue", category: "公立", location: "Pamplona", price: "€11", beds: 112, phone: "+34 948 22 26 44", facilities: ["kitchen", "laundry", "wifi"], landmarks: "潘普洛納主教堂", description: "位於市中心，現代化改建的古老教堂。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 104, lat: 42.6719, lng: -1.8153, name: "Albergue de Peregrinos de los Padres Reparadores", type: "albergue", category: "教會", location: "Puente la Reina", price: "€13", beds: 100, phone: "+34 948 34 00 50", facilities: ["garden", "kitchen", "laundry"], landmarks: "皇后橋", description: "由修會管理，庭院寧靜。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 105, lat: 42.6713, lng: -2.0313, name: "Albergue Municipal de Peregrinos de Estella", type: "albergue", category: "公立", location: "Estella", price: "€6", beds: 96, phone: "+34 948 55 05 48", facilities: ["kitchen", "laundry"], landmarks: "聖彼得教堂", description: "價格實惠，空間寬敞。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 106, lat: 42.5694, lng: -2.1906, name: "Albergue de Peregrinos Isaac Santiago", type: "albergue", category: "公立", location: "Los Arcos", price: "€8", beds: 70, phone: "+34 948 64 00 02", facilities: ["kitchen", "garden"], landmarks: "聖瑪莉亞教堂", description: "比利時之友協會管理。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 107, lat: 42.4664, lng: -2.4456, name: "Albergue Municipal de Peregrinos de Logroño", type: "albergue", category: "公立", location: "Logroño", price: "€10", beds: 64, phone: "+34 941 24 88 18", facilities: ["kitchen", "laundry", "wifi"], landmarks: "聖地牙哥教堂", description: "位於市中心，夏季易客滿。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 108, lat: 42.4156, lng: -2.7344, name: "Albergue Municipal de Nájera", type: "albergue", category: "公立", location: "Nájera", price: "€8", beds: 90, phone: "+34 941 36 00 41", facilities: ["kitchen", "laundry"], landmarks: "修道院", description: "河畔風景優美。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 109, lat: 42.4394, lng: -2.9536, name: "Albergue de Peregrinos de la Cofradía del Santo", type: "albergue", category: "教會", location: "Santo Domingo de la Calzada", price: "€10", beds: 215, phone: "+34 941 34 00 33", facilities: ["kitchen", "laundry"], landmarks: "聖多明哥大教堂", description: "歷史悠久，床位眾多。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 110, lat: 42.4194, lng: -3.1911, name: "Albergue de Peregrinos A Santiago", type: "albergue", category: "私立", location: "Belorado", price: "€12", beds: 40, phone: "+34 947 58 06 17", facilities: ["pool", "bar", "wifi"], landmarks: "聖瑪莉亞教堂", description: "舒適的私立庇護所，有泳池。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 112, lat: 42.3408, lng: -3.7028, name: "Albergue Municipal de Peregrinos de Burgos", type: "albergue", category: "公立", location: "Burgos", price: "€5", beds: 150, phone: "+34 947 26 31 49", facilities: ["kitchen", "laundry", "wifi"], landmarks: "布爾戈斯主教堂", description: "即 Casa de los Cubos，位置絕佳。" },</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Part 2 &amp; 3 Specific Albergues</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 301, lat: 42.7778, lng: -7.4125, name: "Albergue Internacional Monasterio de la Magdalena", type: "albergue", category: "私立", location: "Sarria", price: "€12", beds: 110, phone: "+34 982 53 05 52", facilities: ["laundry", "kitchen", "wifi"], landmarks: "馬格達萊納修道院", description: "位於修道院內的庇護所，環境清幽，適合休息恢復。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 125, lat: 42.8067, lng: -7.6156, name: "Albergue de Peregrinos de la Xunta de Portomarín", type: "albergue", category: "Xunta", location: "Portomarín", price: "€10", beds: 114, phone: "無", facilities: ["kitchen", "laundry"], landmarks: "堡壘教堂", description: "加利西亞公立庇護所 (Xunta)，不能預訂，需排隊。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 126, lat: 42.8739, lng: -7.8692, name: "Albergue de Peregrinos de la Xunta de Palas de Rei", type: "albergue", category: "Xunta", location: "Palas de Rei", price: "€10", beds: 60, phone: "無", facilities: ["kitchen"], landmarks: "聖提爾索教堂", description: "加利西亞公立庇護所。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 127, lat: 42.9269, lng: -8.1644, name: "Albergue de Peregrinos de la Xunta de Arzúa", type: "albergue", category: "Xunta", location: "Arzúa", price: "€10", beds: 46, phone: "無", facilities: ["kitchen"], landmarks: "聖瑪莉亞教堂", description: "公立庇護所，床位較少，建議提早抵達或選擇私立。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 128, lat: 42.9108, lng: -8.3617, name: "Albergue de Peregrinos de la Xunta de Arca do Pino", type: "albergue", category: "Xunta", location: "O Pedrouzo", price: "€10", beds: 126, phone: "無", facilities: ["kitchen", "wifi"], landmarks: "聖艾拉莉亞教堂", description: "位於 O Pedrouzo 的公立庇護所，距離聖地牙哥最後一站。" },</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 129, lat: 42.8805, lng: -8.5439, name: "Seminario Menor de la Asunción", type: "albergue", category: "私立", location: "Santiago de Compostela", price: "€17", beds: 177, phone: "+34 981 58 92 00", facilities: ["kitchen", "laundry", "single_rooms", "wifi"], landmarks: "聖地牙哥主教座堂", description: "由神學院改建，空間巨大，有單人房選項，就在貝爾維斯公園旁。" },</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                     </span>// --- 知名景點 (Sights) ---</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 201, lat: 43.1630, lng: -1.2350, name: "聖雅各之門 (Porte St-Jacques)", type: "sight", description: "法國之路的傳統起點，聯合國教科文組織世界遺產。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 202, lat: 43.0094, lng: -1.3194, name: "朗塞斯瓦列斯聯合教堂", type: "sight", description: "埋葬著羅蘭的傳說之地，哥德式建築的瑰寶，氣氛莊嚴。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 203, lat: 42.8185, lng: -1.6443, name: "潘普洛納主教堂", type: "sight", description: "擁有西班牙最美迴廊之一的哥德式教堂，是奔牛節城市的中心。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 204, lat: 42.6719, lng: -1.8153, name: "皇后橋 (Puente la Reina)", type: "sight", description: "所有朝聖之路匯集於此的羅馬式古橋，是這條路的標誌性建築。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 205, lat: 42.6713, lng: -2.0313, name: "聖彼得教堂 (San Pedro de la Rúa)", type: "sight", description: "位於Estella，擁有壯觀的羅馬式迴廊和長階梯。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 206, lat: 42.4394, lng: -2.9536, name: "聖多明哥大教堂", type: "sight", description: "著名的「雞舍奇蹟」發生地，教堂內真的養著一對活雞。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 207, lat: 42.3408, lng: -3.7028, name: "布爾戈斯主教座堂", type: "sight", description: "西班牙唯一的獨立世界遺產大教堂，哥德式建築的巔峰之作。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 208, lat: 42.2669, lng: -4.4056, name: "聖馬丁教堂", type: "sight", description: "位於Frómista，是西班牙羅馬式建築最完美的典範之一。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 209, lat: 42.5987, lng: -5.5671, name: "萊昂主教座堂", type: "sight", description: "以令人驚嘆的彩繪玻璃窗聞名於世，被稱為「光之屋」。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 210, lat: 42.4597, lng: -6.0567, name: "高第主教宮", type: "sight", description: "高第設計的現代主義建築，外型像童話城堡，現為朝聖者博物館。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 211, lat: 42.4939, lng: -6.3356, name: "鐵十字架 (Cruz de Ferro)", type: "sight", description: "朝聖者會在此放下從家鄉帶來的石頭，象徵放下心中的重擔。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 212, lat: 42.5466, lng: -6.5967, name: "龐費拉達聖殿騎士城堡", type: "sight", description: "保存完好的中世紀聖殿騎士團城堡，規模宏大。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 213, lat: 42.7064, lng: -7.0428, name: "O Cebreiro 茅草屋", type: "sight", description: "加利西亞山區特有的圓形茅草屋 (Pallozas)，彷彿走進古代村落。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 214, lat: 42.8805, lng: -8.5439, name: "聖地牙哥主教座堂", type: "sight", description: "朝聖之路的終點，使徒聖雅各的安息之地，所有朝聖者旅程的目標。" },</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// --- 補充服務點 ---</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 2, lat: 42.8150, lng: -1.6400, name: "Casa Sabina", type: "food", description: "提供朝聖者套餐 (Menú del Peregrino) €12。" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{ id: 3, lat: 42.8100, lng: -1.6500, name: "公共飲水泉", type: "water", description: "可飲用水 (Potable)。" }</p>
<p class="p1"><span class="Apple-converted-space">                </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 裝備清單</p>
<p class="p1"><span class="Apple-converted-space">                </span>const packingList = ref({</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"文件": [</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{ name: "朝聖者護照 (Credencial)", checked: true, weight: 50 },</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{ name: "護照與影本", checked: true, weight: 50 },</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{ name: "保險卡/歐盟健保卡", checked: false, weight: 10 }</p>
<p class="p1"><span class="Apple-converted-space">                    </span>],</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"衣物": [</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{ name: "快乾排汗衫 x2", checked: false, weight: 300 },</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{ name: "登山褲 (可拆式)", checked: false, weight: 400 },</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{ name: "羊毛襪 x3", checked: false, weight: 150 },</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{ name: "輕量雨衣/斗篷", checked: false, weight: 250 }</p>
<p class="p1"><span class="Apple-converted-space">                    </span>],</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"裝備": [</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{ name: "睡袋 (輕量)", checked: false, weight: 800 },</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{ name: "登山杖", checked: false, weight: 500 },</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{ name: "快乾毛巾", checked: false, weight: 100 }</p>
<p class="p1"><span class="Apple-converted-space">                    </span>],</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"個人護理": [</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{ name: "凡士林 (防磨)", checked: false, weight: 50 },</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{ name: "針線包 (挑水泡)", checked: false, weight: 20 },</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{ name: "耳塞 (必備!)", checked: true, weight: 5 }</p>
<p class="p1"><span class="Apple-converted-space">                    </span>]</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 新增項目暫存區</p>
<p class="p1"><span class="Apple-converted-space">                </span>const newItemInput = ref({});</p>
<p class="p1"><span class="Apple-converted-space">                </span>for (const cat in packingList.value) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>newItemInput.value[cat] = { name: '', weight: null };</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 計算屬性</p>
<p class="p1"><span class="Apple-converted-space">                </span>// 總公里數包含虛擬的巴士移動距離</p>
<p class="p1"><span class="Apple-converted-space">                </span>const totalKm = computed(() =&gt; stages.value.reduce((acc, s) =&gt; acc + s.km + (s.virtualKm || 0), 0));</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 完成公里數也包含虛擬距離</p>
<p class="p1"><span class="Apple-converted-space">                </span>const completedKm = computed(() =&gt; stages.value.filter(s =&gt; s.completed).reduce((acc, s) =&gt; acc + s.km + (s.virtualKm || 0), 0));</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const remainingKm = computed(() =&gt; (totalKm.value - completedKm.value).toFixed(1));</p>
<p class="p1"><span class="Apple-converted-space">                </span>const progressPercentage = computed(() =&gt; Math.round((completedKm.value / totalKm.value) * 100));</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 背包總重計算 (單位: kg)</p>
<p class="p1"><span class="Apple-converted-space">                </span>const totalWeight = computed(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>let w = 0;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>for (const cat in packingList.value) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>packingList.value[cat].forEach(i =&gt; w += (Number(i.weight) || 0));</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return (w / 1000).toFixed(2);</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 動態取得下一站推薦住宿</p>
<p class="p1"><span class="Apple-converted-space">                </span>const nextRecommendedAlbergue = computed(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// 找出第一個尚未完成的階段</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const nextStage = stages.value.find(s =&gt; !s.completed);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (!nextStage || !nextStage.endAlbergue) return null;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// 在 POI 列表中尋找匹配的庇護所</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return pois.find(p =&gt; p.name === nextStage.endAlbergue);</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const currentStageName = computed(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const next = stages.value.find(s =&gt; !s.completed);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return next ? `前往 ${next.to}` : '恭喜抵達 Santiago!';</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 預估天數只計算實際步行的剩餘天數 (排除休息日與巴士)</p>
<p class="p1"><span class="Apple-converted-space">                </span>const estimatedDays = computed(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const remainingTotal = stages.value.filter(s =&gt; !s.completed).length;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return remainingTotal;</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// --- 資料持久化 (localStorage) ---</p>
<p class="p1"><span class="Apple-converted-space">                </span>const STORAGE_KEY = 'camino-app-v1';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const saveState = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const state = {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>// 只儲存完成狀態，避免覆蓋路段的靜態資訊</p>
<p class="p1"><span class="Apple-converted-space">                        </span>stageStatus: stages.value.map(s =&gt; s.completed),</p>
<p class="p1"><span class="Apple-converted-space">                        </span>// 裝備清單可能會有新增項目，所以存整個物件</p>
<p class="p1"><span class="Apple-converted-space">                        </span>packingList: packingList.value</p>
<p class="p1"><span class="Apple-converted-space">                    </span>};</p>
<p class="p1"><span class="Apple-converted-space">                    </span>localStorage.setItem(STORAGE_KEY, JSON.stringify(state));</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const loadState = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const saved = localStorage.getItem(STORAGE_KEY);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (saved) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>const parsed = JSON.parse(saved);</p>
<p class="p2"><span class="Apple-converted-space">                            </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>// 還原路段完成狀態</p>
<p class="p1"><span class="Apple-converted-space">                            </span>if (parsed.stageStatus &amp;&amp; Array.isArray(parsed.stageStatus)) {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>parsed.stageStatus.forEach((status, idx) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>if (stages.value[idx]) {</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>stages.value[idx].completed = status;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                                </span>});</p>
<p class="p1"><span class="Apple-converted-space">                            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                            </span>// 還原裝備清單</p>
<p class="p1"><span class="Apple-converted-space">                            </span>if (parsed.packingList) {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>packingList.value = parsed.packingList;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>console.error("Error loading save:", e);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 方法</p>
<p class="p1"><span class="Apple-converted-space">                </span>const setView = (view) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentView.value = view;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (view === 'map') {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>nextTick(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>initMap();</p>
<p class="p1"><span class="Apple-converted-space">                            </span>map.invalidateSize(); // 解決地圖在 hidden 後大小錯誤問題</p>
<p class="p1"><span class="Apple-converted-space">                        </span>});</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 跳轉並定位到特定路段</p>
<p class="p1"><span class="Apple-converted-space">                </span>const flyToStage = (index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>setView('map');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>nextTick(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const stage = stages.value[index];</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (map) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>map.flyTo([stage.lat, stage.lng], 13);</p>
<p class="p1"><span class="Apple-converted-space">                            </span>// 顯示提示</p>
<p class="p1"><span class="Apple-converted-space">                            </span>showToast(`已移動至: ${stage.to}`);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const showToast = (msg) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>toastMsg.value = msg;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>setTimeout(() =&gt; toastMsg.value = '', 2000);</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const quickLog = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showToast("已記錄目前位置！");</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const toggleStage = (index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>stages.value[index].completed = !stages.value[index].completed;</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const expandStage = (index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>expandedStageIndex.value = expandedStageIndex.value === index ? null : index;</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const toggleItem = (cat, idx) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>packingList.value[cat][idx].checked = !packingList.value[cat][idx].checked;</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// --- Swipe Handlers ---</p>
<p class="p1"><span class="Apple-converted-space">                </span>const onSwipeStart = (e, category, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const id = `${category}-${index}`;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (swipeState.value.activeId &amp;&amp; swipeState.value.activeId !== id) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>swipeState.value.activeId = null;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>swipeState.value.isDragging = false;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>return;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>interactingId.value = id;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>swipeState.value.startX = e.touches ? e.touches[0].clientX : e.clientX;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>swipeState.value.startY = e.touches ? e.touches[0].clientY : e.clientY;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>swipeState.value.isDragging = true;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>swipeState.value.baseOffset = (swipeState.value.activeId === id) ? -120 : 0;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>swipeState.value.currentOffset = swipeState.value.baseOffset;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>isSwiping.value = false;</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const onSwipeMove = (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (!swipeState.value.isDragging || !interactingId.value) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>const x = e.touches ? e.touches[0].clientX : e.clientX;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const y = e.touches ? e.touches[0].clientY : e.clientY;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const deltaX = x - swipeState.value.startX;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const deltaY = y - swipeState.value.startY;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (Math.abs(deltaX) &gt; Math.abs(deltaY) &amp;&amp; Math.abs(deltaX) &gt; 10) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (e.cancelable &amp;&amp; e.type === 'touchmove') e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>isSwiping.value = true;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>swipeState.value.activeId = interactingId.value;</p>
<p class="p2"><span class="Apple-converted-space">                        </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>let newOffset = swipeState.value.baseOffset + deltaX;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>swipeState.value.currentOffset = Math.min(0, Math.max(-140, newOffset));</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const onSwipeEnd = (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (!swipeState.value.isDragging || !interactingId.value) return;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>swipeState.value.isDragging = false;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (swipeState.value.currentOffset &lt; -50) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>swipeState.value.activeId = interactingId.value;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>swipeState.value.activeId = null;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>interactingId.value = null;</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const getStyle = (category, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const id = `${category}-${index}`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>let x = 0;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (swipeState.value.activeId === id) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (swipeState.value.isDragging &amp;&amp; interactingId.value === id) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>x = swipeState.value.currentOffset;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>x = -120; // Open state</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>x = 0; // Closed state</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>return { transform: `translateX(${x}px)` };</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 新增項目功能</p>
<p class="p1"><span class="Apple-converted-space">                </span>const addItem = (category) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const input = newItemInput.value[category];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (!input.name) return;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>packingList.value[category].push({</p>
<p class="p1"><span class="Apple-converted-space">                        </span>name: input.name,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>weight: input.weight ? Number(input.weight) : 0,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>checked: false</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                    </span>input.name = '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>input.weight = null;</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 開始編輯</p>
<p class="p1"><span class="Apple-converted-space">                </span>const startEditing = (category, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const item = packingList.value[category][index];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>editingState.value = { category, index };</p>
<p class="p1"><span class="Apple-converted-space">                    </span>editForm.value = { name: item.name, weight: item.weight || 0 };</p>
<p class="p1"><span class="Apple-converted-space">                    </span>swipeState.value.activeId = null;</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 儲存編輯</p>
<p class="p1"><span class="Apple-converted-space">                </span>const saveEdit = (category, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (!editForm.value.name) return;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const item = packingList.value[category][index];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>item.name = editForm.value.name;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>item.weight = Number(editForm.value.weight);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>editingState.value = { category: null, index: null };</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 刪除項目功能</p>
<p class="p1"><span class="Apple-converted-space">                </span>const deleteItem = (category, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>packingList.value[category].splice(index, 1);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>swipeState.value.activeId = null;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const showSyncStatus = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showToast("資料已自動儲存");</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const getPoiTypeLabel = (type) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const labels = { albergue: '住宿', food: '餐飲', water: '水源', sight: '景點' };</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return labels[type] || type;</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const getFacilityName = (key) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const names = {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>kitchen: "廚房",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>laundry: "洗衣機",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>wifi: "WiFi",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>pool: "泳池",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>bar: "酒吧",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>dinner: "供餐",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>garden: "花園",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>hot_water: "熱水",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>single_rooms: "單人房"</p>
<p class="p1"><span class="Apple-converted-space">                    </span>};</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return names[key] || key;</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const toggleMapFilter = (type) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>filters.value[type] = !filters.value[type];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>updateMapMarkers();</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const getStagePois = (locationName) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (!locationName) return [];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return pois.filter(p =&gt; p.type === 'albergue' &amp;&amp; p.location === locationName);</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const showPoiOnMap = (poi) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>selectedPOI.value = poi;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>setView('map');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>nextTick(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (map) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>map.flyTo([poi.lat - 0.002, poi.lng], 16);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Map Initialization</p>
<p class="p1"><span class="Apple-converted-space">                </span>let markers = [];</p>
<p class="p1"><span class="Apple-converted-space">                </span>const initMap = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (map) return;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// 初始化地圖</p>
<p class="p1"><span class="Apple-converted-space">                    </span>map = L.map('map', { zoomControl: false });</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// 使用 OpenStreetMap tiles (實際離線需要 cache 機制)</p>
<p class="p1"><span class="Apple-converted-space">                    </span>L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>attribution: '&amp;copy; OSM',</p>
<p class="p1"><span class="Apple-converted-space">                        </span>maxZoom: 19</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}).addTo(map);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// --- 繪製路線 (Polyline) ---</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// 組合所有座標點：起點 + 各階段終點</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const routeCoordinates = [</p>
<p class="p1"><span class="Apple-converted-space">                        </span>[startPoint.lat, startPoint.lng], // 起點</p>
<p class="p1"><span class="Apple-converted-space">                        </span>...stages.value.map(s =&gt; [s.lat, s.lng]) // 各路段終點</p>
<p class="p1"><span class="Apple-converted-space">                    </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// 繪製黃色箭頭路徑</p>
<p class="p1"><span class="Apple-converted-space">                    </span>L.polyline(routeCoordinates, {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>color: '#f59e0b', // Camino Yellow</p>
<p class="p1"><span class="Apple-converted-space">                        </span>weight: 5,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>opacity: 0.8,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>lineCap: 'round'</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}).addTo(map);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// 在每個路段終點加上小圓點標記 (視覺化路段)</p>
<p class="p1"><span class="Apple-converted-space">                    </span>routeCoordinates.forEach((coord, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>L.circleMarker(coord, {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>radius: 4,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>fillColor: 'white',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>color: '#f59e0b',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>weight: 2,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>opacity: 1,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>fillOpacity: 1</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}).addTo(map);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// POI Icons</p>
<p class="p1"><span class="Apple-converted-space">                    </span>updateMapMarkers();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// 自動縮放地圖以顯示整條路線</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// 建立一個 Bounds 包含起點和終點</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const bounds = L.latLngBounds(routeCoordinates);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>map.fitBounds(bounds, { padding: [50, 50] });</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const updateMapMarkers = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// 清除舊標記</p>
<p class="p1"><span class="Apple-converted-space">                    </span>markers.forEach(m =&gt; map.removeLayer(m));</p>
<p class="p1"><span class="Apple-converted-space">                    </span>markers = [];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>pois.forEach(poi =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (!filters.value[poi.type]) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>let iconClass = '';</p>
<p class="p1"><span class="Apple-converted-space">                        </span>let colorClass = '';</p>
<p class="p2"><span class="Apple-converted-space">                        </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (poi.type === 'albergue') { iconClass = 'fa-bed'; colorClass = 'text-blue-600'; }</p>
<p class="p1"><span class="Apple-converted-space">                        </span>else if (poi.type === 'sight') { iconClass = 'fa-camera'; colorClass = 'text-purple-600'; }</p>
<p class="p1"><span class="Apple-converted-space">                        </span>else if (poi.type === 'food') { iconClass = 'fa-utensils'; colorClass = 'text-green-600'; }</p>
<p class="p1"><span class="Apple-converted-space">                        </span>else if (poi.type === 'water') { iconClass = 'fa-faucet'; colorClass = 'text-blue-400'; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>const customIcon = L.divIcon({</p>
<p class="p1"><span class="Apple-converted-space">                            </span>className: 'custom-div-icon',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>html: `&lt;div class="bg-white rounded-full w-8 h-8 flex items-center justify-center shadow-md border-2 border-white ${colorClass}"&gt;&lt;i class="fa-solid ${iconClass}"&gt;&lt;/i&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>iconSize: [30, 30],</p>
<p class="p1"><span class="Apple-converted-space">                            </span>iconAnchor: [15, 30]</p>
<p class="p1"><span class="Apple-converted-space">                        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>const marker = L.marker([poi.lat, poi.lng], { icon: customIcon }).addTo(map);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>marker.on('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>selectedPOI.value = poi;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>// 將地圖中心移到 POI 並稍微向下偏移以留空間給卡片</p>
<p class="p1"><span class="Apple-converted-space">                            </span>map.flyTo([poi.lat - 0.002, poi.lng], 16);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>});</p>
<p class="p1"><span class="Apple-converted-space">                        </span>markers.push(marker);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const locateUser = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (!navigator.geolocation) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>showToast("瀏覽器不支援定位");</p>
<p class="p1"><span class="Apple-converted-space">                        </span>return;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showToast("正在定位...");</p>
<p class="p1"><span class="Apple-converted-space">                    </span>navigator.geolocation.getCurrentPosition((pos) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const { latitude, longitude } = pos.coords;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (userMarker) map.removeLayer(userMarker);</p>
<p class="p2"><span class="Apple-converted-space">                        </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>// 藍色圓點</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const userIcon = L.divIcon({</p>
<p class="p1"><span class="Apple-converted-space">                            </span>className: 'user-location-icon',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>html: '&lt;div class="w-4 h-4 bg-blue-500 rounded-full border-2 border-white shadow-lg animate-pulse"&gt;&lt;/div&gt;',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>iconSize: [16, 16]</p>
<p class="p1"><span class="Apple-converted-space">                        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>userMarker = L.marker([latitude, longitude], { icon: userIcon }).addTo(map);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>map.flyTo([latitude, longitude], 15);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}, (err) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>showToast("定位失敗: " + err.message);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>// Fallback 模擬 (回到起點)</p>
<p class="p1"><span class="Apple-converted-space">                        </span>map.flyTo([startPoint.lat, startPoint.lng], 15);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const downloadOfflineMap = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showToast("正在下載此區域圖資...");</p>
<p class="p1"><span class="Apple-converted-space">                    </span>setTimeout(() =&gt; showToast("下載完成 (模擬)"), 1500);</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 生命週期</p>
<p class="p1"><span class="Apple-converted-space">                </span>onMounted(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>loadState(); // 先讀取存檔</p>
<p class="p1"><span class="Apple-converted-space">                    </span>initMap();</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 監聽器 - 自動存檔</p>
<p class="p1"><span class="Apple-converted-space">                </span>watch(stages, () =&gt; saveState(), { deep: true });</p>
<p class="p1"><span class="Apple-converted-space">                </span>watch(packingList, () =&gt; saveState(), { deep: true });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>return {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentView,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>stages,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>packingList,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>guideTab,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>toastMsg,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>expandedStageIndex,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>selectedPOI,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>filters,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Computed</p>
<p class="p1"><span class="Apple-converted-space">                    </span>totalKm,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>completedKm,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>remainingKm,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>progressPercentage,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentStageName,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>estimatedDays,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>nextRecommendedAlbergue,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Methods</p>
<p class="p1"><span class="Apple-converted-space">                    </span>setView,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>quickLog,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>toggleStage,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>expandStage,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>toggleItem,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>addItem,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>deleteItem,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>startEditing,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>saveEdit,<span class="Apple-converted-space">     </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>editingState,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>editForm,<span class="Apple-converted-space">     </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>totalWeight,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>newItemInput,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>showSyncStatus,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>locateUser,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>downloadOfflineMap,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>getPoiTypeLabel,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>toggleMapFilter,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>getFacilityName,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>flyToStage,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>getStagePois,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showPoiOnMap,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>hourlyForecast,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>clothingAdvice,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>isWeatherExpanded,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Swipe</p>
<p class="p1"><span class="Apple-converted-space">                    </span>handleTouchStart: onSwipeStart,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>handleTouchMove: onSwipeMove,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>handleTouchEnd: onSwipeEnd,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>getSwipeStyle: getStyle,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>isSwiping</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}).mount('#app');</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
